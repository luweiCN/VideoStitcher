# 任务中心 UI 设计规范

## 一、页面架构

### 1.1 整体结构

```
┌─────────────────────────────────────────────────────────────────────┐
│                              首页                                    │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │  任务中心入口卡片                                    [右上角指示器]││
│  └─────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                          功能模块页面                                │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │  PageHeader                                      [任务指示器按钮]││
│  │  [← 返回]  标题                                    [状态徽章]   ││
│  └─────────────────────────────────────────────────────────────────┘│
│  ... 功能内容 ...                                                   │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │                      [添加到任务中心]                           ││
│  └─────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                          任务中心浮窗                                │
│  ╔═══════════════════════════════════════════════════════════════╗ │
│  ║  任务中心                              运行时间: 02:34:15    ▼ ║ │
│  ║  ┌──────────────────────────────────────────────────────────┐ ║ │
│  ║  │ 并发: 2 任务  ·  线程: 4/任务                    [⚙]   │ ║ │
│  ║  └──────────────────────────────────────────────────────────┘ ║ │
│  ╠═══════════════════════════════════════════════════════════════╣ │
│  ║  ● 任务1  横屏合成      45%  ████████░░░░░░░░░░░░░░░░░░░░░  ║ │
│  ║  ● 任务2  A+B拼接       23%  █████░░░░░░░░░░░░░░░░░░░░░░░░  ║ │
│  ╠═══════════════════════════════════════════════════════════════╣ │
│  ║                    [打开任务列表]  [全部暂停]                  ║ │
│  ╚═══════════════════════════════════════════════════════════════╝ │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 二、并发控制组件

### 2.1 任务中心浮窗中的并发控制

在任务中心浮窗顶部显示当前并发配置，点击可快速调整：

```
┌──────────────────────────────────────────────────────────────────┐
│  并发: 2 任务  ·  线程: 4/任务                           [⚙]    │
└──────────────────────────────────────────────────────────────────┘

点击后展开：
┌──────────────────────────────────────────────────────────────────┐
│  并发控制                                                        │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  同时执行任务数                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  ●━━━━━━━━━━━━●━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │ │
│  └────────────────────────────────────────────────────────────┘ │
│  1    2    3    4    5    6    7    8                           │
│  当前: 2 个任务（共使用 8 个线程）                               │
│                                                                  │
│  每个任务使用线程数                                              │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  ●━━━━━━━━━━━━━━━━━━━━━━━━━━━━●━━━━━━━━━━━━━━━━━━━━━━━━━━  │ │
│  └────────────────────────────────────────────────────────────┘ │
│  1         4         8        12        16                      │
│  当前: 4 线程/任务（CPU: 8 核心）                                │
│                                                                  │
│  [恢复默认]                                          [应用]      │
└──────────────────────────────────────────────────────────────────┘
```

### 2.2 设置页面中的任务中心配置

在设置页面「任务中心」标签页中：

```
┌──────────────────────────────────────────────────────────────────────┐
│  设置 > 任务中心                                                     │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─── 并发设置 ───────────────────────────────────────────────────┐ │
│  │                                                                  │ │
│  │  CPU 信息                                                        │ │
│  │  ┌────────────────────────────────────────────────────────────┐ │ │
│  │  │  检测到 8 个 CPU 核心                                       │ │ │
│  │  │  建议配置: 2 任务 × 4 线程 或 4 任务 × 2 线程               │ │ │
│  │  └────────────────────────────────────────────────────────────┘ │ │
│  │                                                                  │ │
│  │  最大同时执行任务数                                              │ │
│  │  ┌────────────────────────────────────────────────────────────┐ │ │
│  │  │  ●━━━━━━━━━━━━●━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │ │ │
│  │  └────────────────────────────────────────────────────────────┘ │ │
│  │  1    2    3    4    5    6    7    8                           │ │
│  │  当前: 2 个任务                                                  │ │
│  │                                                                  │ │
│  │  每个任务使用的线程数                                            │ │
│  │  ┌────────────────────────────────────────────────────────────┐ │ │
│  │  │  ●━━━━━━━━━━━━━━━━━━━━━━━━━━━━●━━━━━━━━━━━━━━━━━━━━━━━━━━  │ │ │
│  │  └────────────────────────────────────────────────────────────┘ │ │
│  │  1         4         8        12        16                      │ │
│  │  当前: 4 线程（推荐: CPU核心数 - 1）                            │ │
│  │                                                                  │ │
│  │  ⚠ 预计最大线程使用: 2 × 4 = 8 个（与 CPU 核心数匹配）         │ │
│  │                                                                  │ │
│  └──────────────────────────────────────────────────────────────────┘ │
│                                                                      │
│  ┌─── 自动化设置 ───────────────────────────────────────────────────┐ │
│  │                                                                  │ │
│  │  [✓] 添加任务后自动开始执行                                      │ │
│  │  [ ] 失败后自动重试 (最多 3 次)                                  │ │
│  │  [✓] 任务完成后显示系统通知                                      │ │
│  │                                                                  │ │
│  └──────────────────────────────────────────────────────────────────┘ │
│                                                                      │
│                                              [恢复默认] [保存设置]   │
└──────────────────────────────────────────────────────────────────────┘
```

### 2.3 组件代码示例

```tsx
// src/renderer/components/TaskCenter/ConcurrencyControl.tsx

interface ConcurrencyControlProps {
  maxConcurrentTasks: number;
  threadsPerTask: number;
  cpuCores: number;
  onChange: (config: { maxConcurrentTasks: number; threadsPerTask: number }) => void;
  compact?: boolean;  // 紧凑模式（用于浮窗）
}

const ConcurrencyControl: React.FC<ConcurrencyControlProps> = ({
  maxConcurrentTasks,
  threadsPerTask,
  cpuCores,
  onChange,
  compact = false,
}) => {
  const totalThreads = maxConcurrentTasks * threadsPerTask;
  const isOverloaded = totalThreads > cpuCores;
  
  if (compact) {
    return (
      <div className="flex items-center gap-3 px-3 py-2 bg-slate-800/50 rounded-lg">
        <span className="text-xs text-slate-400">并发:</span>
        <button 
          onClick={() => setShowDetail(true)}
          className="flex items-center gap-1 text-xs text-slate-200 hover:text-white"
        >
          <span className="text-violet-400 font-medium">{maxConcurrentTasks}</span>
          <span className="text-slate-500">任务</span>
          <span className="text-slate-600">·</span>
          <span className="text-cyan-400 font-medium">{threadsPerTask}</span>
          <span className="text-slate-500">线程/任务</span>
        </button>
        {isOverloaded && (
          <span className="text-xs text-amber-400">⚠</span>
        )}
        <Settings className="w-3.5 h-3.5 text-slate-500" />
      </div>
    );
  }
  
  return (
    <div className="space-y-6">
      {/* CPU 信息 */}
      <div className={cn(
        "p-3 rounded-lg",
        isOverloaded ? "bg-amber-500/10 border border-amber-500/30" : "bg-slate-800/50"
      )}>
        <div className="flex items-center gap-2">
          <Cpu className="w-4 h-4 text-slate-400" />
          <span className="text-sm text-slate-300">
            检测到 <span className="font-medium text-white">{cpuCores}</span> 个 CPU 核心
          </span>
        </div>
        <p className="text-xs text-slate-500 mt-1">
          预计线程使用: {totalThreads} 个
          {isOverloaded && (
            <span className="text-amber-400 ml-2">⚠ 超过 CPU 核心数，可能影响性能</span>
          )}
        </p>
      </div>
      
      {/* 同时执行任务数 */}
      <div>
        <label className="text-sm text-slate-300 mb-2 block">同时执行任务数</label>
        <Slider
          value={[maxConcurrentTasks]}
          min={1}
          max={8}
          step={1}
          onValueChange={([value]) => 
            onChange({ maxConcurrentTasks: value, threadsPerTask })
          }
        />
        <div className="flex justify-between text-xs text-slate-500 mt-1">
          <span>1</span>
          <span>当前: {maxConcurrentTasks} 个任务</span>
          <span>8</span>
        </div>
      </div>
      
      {/* 每个任务线程数 */}
      <div>
        <label className="text-sm text-slate-300 mb-2 block">每个任务使用线程数</label>
        <Slider
          value={[threadsPerTask]}
          min={1}
          max={16}
          step={1}
          onValueChange={([value]) => 
            onChange({ maxConcurrentTasks, threadsPerTask: value })
          }
        />
        <div className="flex justify-between text-xs text-slate-500 mt-1">
          <span>1</span>
          <span>当前: {threadsPerTask} 线程</span>
          <span>16</span>
        </div>
      </div>
    </div>
  );
};
```

---

## 三、任务指示器组件

### 2.1 首页右上角指示器（详细版）

位置：首页右上角固定位置

```
┌────────────────────────────────────────────────┐
│  ┌────┐                                        │
│  │ ▶  │  任务中心                    2 运行中  │
│  │    │  ████████░░░░░░░░░░░░ 45%  总计 128   │
│  └────┘                                        │
└────────────────────────────────────────────────┘

有任务运行时:
┌────────────────────────────────────────────────┐
│  ┌────┐  任务中心                              │
│  │ ▶● │  2 运行中  ·  运行时间 02:34:15       │
│  │    │  ████████░░░░░░░░░░░░ 45%            │
│  └────┘  点击查看详情                          │
└────────────────────────────────────────────────┘

无任务运行时:
┌────────────────────────────────────────────────┐
│  ┌────┐  任务中心                              │
│  │ ▶  │  暂无运行中任务                        │
│  │    │  128 已完成  ·  3 待执行               │
│  └────┘  点击进入任务列表                      │
└────────────────────────────────────────────────┘
```

**组件代码结构**:
```tsx
// src/renderer/components/TaskIndicator/HomeTaskIndicator.tsx

<div className="fixed top-6 right-6 z-50">
  <button
    onClick={onOpenTaskCenter}
    className="group flex items-center gap-3 px-4 py-3 bg-slate-900/90 backdrop-blur-xl 
               border border-slate-700/50 rounded-xl hover:border-violet-500/50 
               transition-all duration-300 shadow-lg"
  >
    {/* 图标 */}
    <div className={cn(
      "w-10 h-10 rounded-lg flex items-center justify-center transition-colors",
      hasRunningTasks 
        ? "bg-gradient-to-br from-violet-600 to-purple-600" 
        : "bg-slate-800"
    )}>
      {hasRunningTasks ? (
        <Loader2 className="w-5 h-5 text-white animate-spin" />
      ) : (
        <Layers className="w-5 h-5 text-slate-400" />
      )}
    </div>
    
    {/* 信息区 */}
    <div className="text-left">
      <div className="flex items-center gap-2">
        <span className="text-sm font-medium text-white">任务中心</span>
        {hasRunningTasks && (
          <span className="text-xs text-violet-400">{runningCount} 运行中</span>
        )}
      </div>
      
      {hasRunningTasks ? (
        <>
          <div className="flex items-center gap-2 mt-1">
            <span className="text-xs text-slate-400">运行时间</span>
            <span className="text-xs font-mono text-emerald-400">{formatTime(totalRunTime)}</span>
          </div>
          <div className="w-32 h-1.5 bg-slate-800 rounded-full mt-1.5 overflow-hidden">
            <div 
              className="h-full bg-gradient-to-r from-violet-500 to-purple-500 transition-all"
              style={{ width: `${avgProgress}%` }}
            />
          </div>
        </>
      ) : (
        <div className="text-xs text-slate-400 mt-0.5">
          {completedCount} 已完成 · {pendingCount} 待执行
        </div>
      )}
    </div>
    
    {/* 箭头 */}
    <ChevronRight className="w-4 h-4 text-slate-500 group-hover:text-white transition-colors" />
  </button>
</div>
```

### 2.2 功能页面 PageHeader 指示器（简洁版）

位置：PageHeader 组件右侧

```
无任务时:
┌────────────────────────┐
│  任务中心    0 运行中  │
└────────────────────────┘

有任务运行时:
┌────────────────────────────────────────┐
│  任务中心    2 运行中    45%  ████████ │
└────────────────────────────────────────┘

点击展开浮窗:
┌────────────────────────────────────────┐
│  ▲                                      │
│  ┌────────────────────────────────────┐│
│  │ ● 任务1  45%  ████████░░░░░░░░░░░││
│  │ ● 任务2  23%  █████░░░░░░░░░░░░░││
│  └────────────────────────────────────┘│
│         [打开任务列表]  [全部暂停]      │
└────────────────────────────────────────┘
```

**组件代码结构**:
```tsx
// src/renderer/components/TaskIndicator/HeaderTaskIndicator.tsx

<div className="relative">
  <button
    onClick={() => setShowPopover(!showPopover)}
    className="flex items-center gap-2 px-3 py-1.5 bg-slate-900/80 
               border border-slate-700/50 rounded-lg hover:border-violet-500/50 
               transition-colors"
  >
    <Layers className={cn(
      "w-4 h-4",
      hasRunningTasks ? "text-violet-400" : "text-slate-400"
    )} />
    <span className="text-xs font-medium text-slate-300">任务中心</span>
    
    {hasRunningTasks && (
      <>
        <span className="text-xs text-violet-400">{runningCount}</span>
        <div className="w-16 h-1 bg-slate-800 rounded-full overflow-hidden">
          <div 
            className="h-full bg-violet-500 transition-all"
            style={{ width: `${avgProgress}%` }}
          />
        </div>
      </>
    )}
  </button>
  
  {/* 展开的浮窗 */}
  {showPopover && (
    <div className="absolute top-full right-0 mt-2 w-72 bg-slate-900 
                    border border-slate-700 rounded-xl shadow-xl z-50">
      {/* 运行中的任务列表 */}
      <div className="p-3 space-y-2">
        {runningTasks.map(task => (
          <RunningTaskItem key={task.id} task={task} />
        ))}
      </div>
      
      {/* 操作按钮 */}
      <div className="border-t border-slate-700 p-2 flex gap-2">
        <button onClick={onOpenTaskList} className="flex-1 text-xs py-1.5 ...">
          打开任务列表
        </button>
        <button onClick={onPauseAll} className="flex-1 text-xs py-1.5 ...">
          全部暂停
        </button>
      </div>
    </div>
  )}
</div>
```

---

## 三、任务中心浮窗（全局）

### 3.1 浮窗设计

位置：可拖动，默认右下角

```
收起状态:
┌──────────────────────────────────────┐
│ ▶  任务中心      2运行  02:34:15    ▲│
└──────────────────────────────────────┘

展开状态:
╔══════════════════════════════════════╗
║  ▶  任务中心      2运行  02:34:15   ▼║
╠══════════════════════════════════════╣
║                                      ║
║  ┌────────────────────────────────┐ ║
║  │ ● 任务1 - 横屏合成             │ ║
║  │   ████████████░░░░░░░░░░ 45%  │ ║
║  │   正在处理第 3/10 个视频       │ ║
║  └────────────────────────────────┘ ║
║                                      ║
║  ┌────────────────────────────────┐ ║
║  │ ● 任务2 - A+B拼接              │ ║
║  │   █████░░░░░░░░░░░░░░░░ 23%   │ ║
║  │   正在合并视频...              │ ║
║  └────────────────────────────────┘ ║
║                                      ║
╠══════════════════════════════════════╣
║       [打开任务列表]    [全部暂停]   ║
╚══════════════════════════════════════╝
```

### 3.2 组件结构

```tsx
// src/renderer/components/TaskCenter/TaskCenterWidget.tsx

const TaskCenterWidget: React.FC = () => {
  const [collapsed, setCollapsed] = useState(true);
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const { runningTasks, totalRunTime } = useTaskCenter();
  
  if (runningTasks.length === 0) {
    return null;  // 无运行中任务时不显示
  }
  
  return (
    <Draggable position={position} onDrag={setPosition}>
      <div className="fixed z-[9999] min-w-[280px]">
        {/* 头部 */}
        <div 
          className="bg-slate-900/95 backdrop-blur-xl border border-slate-700 
                     rounded-t-xl px-4 py-2 flex items-center cursor-pointer"
          onClick={() => setCollapsed(!collapsed)}
        >
          <Loader2 className="w-4 h-4 text-violet-400 animate-spin mr-2" />
          <span className="text-sm font-medium text-white">任务中心</span>
          <span className="ml-2 text-xs text-violet-400">{runningTasks.length}运行</span>
          <span className="ml-auto text-xs font-mono text-emerald-400">
            {formatTime(totalRunTime)}
          </span>
          {collapsed ? <ChevronUp className="w-4 h-4 ml-2" /> : <ChevronDown className="w-4 h-4 ml-2" />}
        </div>
        
        {/* 内容区 */}
        {!collapsed && (
          <div className="bg-slate-900/95 backdrop-blur-xl border-x border-slate-700 
                          p-3 space-y-2 max-h-80 overflow-y-auto">
            {runningTasks.map(task => (
              <RunningTaskItem key={task.id} task={task} />
            ))}
          </div>
        )}
        
        {/* 操作区 */}
        {!collapsed && (
          <div className="bg-slate-900/95 backdrop-blur-xl border border-t-0 
                          border-slate-700 rounded-b-xl p-2 flex gap-2">
            <button 
              onClick={onOpenTaskList}
              className="flex-1 text-xs py-2 bg-violet-600 text-white rounded-lg"
            >
              打开任务列表
            </button>
            <button 
              onClick={onPauseAll}
              className="flex-1 text-xs py-2 bg-slate-700 text-slate-300 rounded-lg"
            >
              全部暂停
            </button>
          </div>
        )}
      </div>
    </Draggable>
  );
};
```

---

## 四、任务列表页面

### 4.1 页面布局

独立页面，从首页入口进入

```
┌──────────────────────────────────────────────────────────────────────────┐
│  [← 返回]                    任务列表                      [⚙ 设置]    │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │  统计概览                                                           ││
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      ││
│  │  │ 待执行  │ │ 执行中  │ │ 已完成  │ │  失败   │ │ 总计    │      ││
│  │  │   12    │ │    2    │ │   128   │ │    3    │ │   145   │      ││
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘      ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │  筛选栏                                                             ││
│  │  [状态 ▼] [类型 ▼] [日期范围] [搜索...]           [清空已完成]      ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │  任务列表（虚拟滚动）                                               ││
│  │                                                                     ││
│  │  ┌───────────────────────────────────────────────────────────────┐ ││
│  │  │ [缩略图]  任务名称                         状态      进度     │ ││
│  │  │           输出目录 /Users/xxx/output                         │ ││
│  │  │           创建时间 2024-01-15 14:30   执行时间 00:05:23      │ ││
│  │  │                                           [操作按钮] [详情→] │ ││
│  │  └───────────────────────────────────────────────────────────────┘ ││
│  │                                                                     ││
│  │  ┌───────────────────────────────────────────────────────────────┐ ││
│  │  │ ...                                                           │ ││
│  │  └───────────────────────────────────────────────────────────────┘ ││
│  │                                                                     ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │  分页: < 1 2 3 ... 15 >                           显示 1-50 / 145  ││
│  └─────────────────────────────────────────────────────────────────────┘│
└──────────────────────────────────────────────────────────────────────────┘
```

### 4.2 任务卡片设计

```
┌────────────────────────────────────────────────────────────────────────┐
│  ┌────────┐                                                            │
│  │        │  横屏合成 - video_a.mp4 + video_b.mp4                      │
│  │ 缩略图  │                                                            │
│  │  64px  │  ┌─────────────────────────────────┐                       │
│  │        │  │ ● 执行中                    45% │                       │
│  └────────┘  └─────────────────────────────────┘                       │
│                                                                        │
│  输出: /Users/xxx/output                              [修改]            │
│                                                                        │
│  创建: 2024-01-15 14:30    执行时间: 00:05:23                          │
│                                                                        │
│  ████████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░             │
│  正在处理第 3/10 个视频                                                │
│                                                                        │
│                                              [暂停] [取消] [查看详情→] │
└────────────────────────────────────────────────────────────────────────┘
```

**状态对应操作按钮**:

| 状态 | 可用操作 |
|------|----------|
| pending | [开始] [修改目录] [删除] [详情] |
| queued | [取消] [修改目录] [详情] |
| running | [暂停] [取消] [详情] |
| paused | [恢复] [取消] [删除] [详情] |
| completed | [打开目录] [预览] [删除] [详情] |
| failed | [重试] [修改目录] [删除] [详情] |
| cancelled | [重试] [修改目录] [删除] [详情] |

---

## 五、任务详情页面

### 5.1 页面布局

独立页面，从任务列表点击进入

```
┌──────────────────────────────────────────────────────────────────────────┐
│  [← 返回列表]                  任务详情                                  │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─── 任务信息 ───────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  任务名称: 横屏合成 - video_a.mp4 + video_b.mp4                     │ │
│  │  任务类型: 横竖屏极速合成                                            │ │
│  │  任务状态: ● 执行中                              进度: 45%          │ │
│  │                                                                      │ │
│  │  创建时间: 2024-01-15 14:30:00                                      │ │
│  │  开始时间: 2024-01-15 14:32:15                                      │ │
│  │  执行时间: 00:05:23 (暂停期间不计入)                                 │ │
│  │                                                                      │ │
│  │  输出目录: /Users/xxx/output                       [修改] [打开目录]│ │
│  │                                                                      │ │
│  │  ████████████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░          │ │
│  │  正在处理第 3/10 个视频                                              │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─── 素材列表 ───────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  ┌────┐  A面-1: video_a.mp4                                         │ │
│  │  │ 👁 │  1920×1080 · 00:30 · 45.2MB                                │ │
│  │  └────┘                                                              │ │
│  │                                                                      │ │
│  │  ┌────┐  B面-1: video_b.mp4                                         │ │
│  │  │ 👁 │  1920×1080 · 01:20 · 120MB                                 │ │
│  │  └────┘                                                              │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─── 任务参数 ───────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  方向: 横屏 (1920×1080)                                             │ │
│  │  A面位置: x=0, y=0, w=1920, h=1080                                  │ │
│  │  B面位置: x=0, y=0, w=1920, h=1080                                  │ │
│  │  并发数: 4                                                          │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─── 输出文件 ───────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  尚无输出文件                                                        │ │
│  │                                                                      │ │
│  │  -- 任务完成后显示 --                                                │ │
│  │  [1] output_001.mp4  1920×1080 · 01:50 · 95MB  [预览] [打开目录]    │ │
│  │  [2] output_002.mp4  1920×1080 · 01:50 · 95MB  [预览] [打开目录]    │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─── 执行日志 ───────────────────────────────────────────────────────┐ │
│  │  ┌────────────────────────────────────────────────────────────────┐ │ │
│  │  │ [14:32:15] [INFO]  开始处理任务...                             │ │ │
│  │  │ [14:32:16] [INFO]  正在处理第 1/10 个视频...                   │ │ │
│  │  │ [14:32:45] [INFO]  正在处理第 2/10 个视频...                   │ │ │
│  │  │ [14:33:12] [WARN]  视频帧率不一致，已自动转换                  │ │ │
│  │  │ [14:33:30] [INFO]  正在处理第 3/10 个视频...                   │ │ │
│  │  │                                             ▼ 自动滚动         │ │ │
│  │  └────────────────────────────────────────────────────────────────┘ │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│                                              [暂停] [取消] [重试]       │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 六、数据库管理设置页面

### 6.1 位置

在设置页面（AdminMode）中添加「数据库」标签页

### 6.2 页面设计

```
┌──────────────────────────────────────────────────────────────────────────┐
│  设置                                                                    │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  [系统] [任务中心] [数据库] [更新]                                  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─── 数据库信息 ─────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  数据库位置                                                          │ │
│  │  /Users/xxx/Library/Application Support/VideoStitcher/VideoStitcher.db│
│  │                                                     [打开目录]       │ │
│  │                                                                      │ │
│  │  数据库大小: 15.2 MB                                                 │ │
│  │  任务总数: 145 条                                                    │ │
│  │  日志总数: 12,345 条                                                 │ │
│  │  最早任务: 2024-01-01                                                │ │
│  │  最近任务: 2024-01-15                                                │ │
│  │                                                                      │ │
│  │  数据库状态: ✓ 健康                               [检查完整性]       │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─── 数据清理 ───────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  清理已完成任务                                                      │ │
│  │  ┌────────────────────────┐                                         │ │
│  │  │ 7 天前               ▼ │  [清理]                                 │ │
│  │  └────────────────────────┘                                         │ │
│  │  选项: 1天前 | 3天前 | 7天前 | 30天前 | 全部                         │ │
│  │                                                                      │ │
│  │  清理失败任务                                          [清理全部]    │ │
│  │  清理已取消任务                                        [清理全部]    │ │
│  │  清理所有日志                                          [清理全部]    │ │
│  │                                                                      │ │
│  │  ⚠ 清理操作不可恢复，建议先备份数据库                                │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─── 备份管理 ───────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  自动备份                                         [开关 ✓]          │ │
│  │  每次启动应用时自动创建备份                                          │ │
│  │                                                                      │ │
│  │  保留备份数量                                    5 份                │ │
│  │                                                                      │ │
│  │  立即备份                                            [创建备份]      │ │
│  │                                                                      │ │
│  │  导出数据库                                          [导出]          │ │
│  │  将数据库导出为文件，可用于迁移或存档                                │ │
│  │                                                                      │ │
│  │  导入数据库                                          [选择文件]      │ │
│  │  从备份文件恢复数据库（会覆盖当前数据）                              │ │
│  │                                                                      │ │
│  │  备份列表                                                            │ │
│  │  ┌────────────────────────────────────────────────────────────────┐ │ │
│  │  │ VideoStitcher_2024-01-15.db    15.1 MB   2024-01-15 14:30      │ │ │
│  │  │                                              [恢复] [删除] [下载]│ │ │
│  │  ├────────────────────────────────────────────────────────────────┤ │ │
│  │  │ VideoStitcher_2024-01-14.db    14.8 MB   2024-01-14 09:15      │ │ │
│  │  │                                              [恢复] [删除] [下载]│ │ │
│  │  └────────────────────────────────────────────────────────────────┘ │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─── 数据库修复 ─────────────────────────────────────────────────────┐ │
│  │                                                                      │ │
│  │  如果数据库出现问题（如任务无法加载、数据丢失等），                   │ │
│  │  可以尝试修复数据库。修复前会自动创建备份。                          │ │
│  │                                                                      │ │
│  │                                                    [修复数据库]      │ │
│  │                                                                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 七、功能模块改造

### 7.1 改造要点

1. **移除原有处理逻辑**
   - 移除 `isProcessing` 状态
   - 移除 `startProcessing` 函数
   - 移除 `useVideoProcessingEvents` 等处理事件 hooks
   - 移除 OperationLogPanel（日志在任务详情中查看）

2. **按钮改造**
   - 「开始处理」→「添加到任务中心」
   - 按钮文案更简洁

3. **添加任务后弹窗**
   - 显示任务添加成功
   - 询问是否清空编辑区域
   - 确认后清空所有素材和参数

### 7.2 添加任务成功弹窗

```
┌────────────────────────────────────────────────┐
│                      ✓                         │
│                                                │
│             任务已添加到任务中心               │
│                                                │
│        任务 ID: abc123-def456-...             │
│                                                │
│  ┌────────────────────────────────────────┐   │
│  │  是否清空当前编辑区域？                │   │
│  │                                        │   │
│  │  清空后可以继续添加新任务              │   │
│  └────────────────────────────────────────┘   │
│                                                │
│      [保留当前内容]      [清空并继续]          │
│                                                │
└────────────────────────────────────────────────┘
```

### 7.3 组件代码示例

```tsx
// 添加任务后的处理
const handleAddToTaskCenter = async () => {
  if (!validateTask()) {
    return;
  }
  
  const result = await window.api.createTask({
    type: 'video_merge',
    name: generateTaskName(),
    outputDir,
    params: buildTaskParams(),
    files: buildTaskFiles(),
  });
  
  if (result.success) {
    setShowAddSuccessModal(true);
    setCreatedTaskId(result.task!.id);
  }
};

// 弹窗组件
const AddSuccessModal: React.FC<{
  visible: boolean;
  taskId: string;
  onKeepContent: () => void;
  onClearContent: () => void;
}> = ({ visible, taskId, onKeepContent, onClearContent }) => {
  return (
    <Modal visible={visible} onClose={onKeepContent}>
      <div className="p-6 text-center">
        <CheckCircle className="w-12 h-12 text-emerald-500 mx-auto mb-4" />
        
        <h3 className="text-lg font-medium text-white mb-2">
          任务已添加到任务中心
        </h3>
        
        <p className="text-sm text-slate-400 mb-4">
          任务 ID: {taskId.slice(0, 12)}...
        </p>
        
        <div className="bg-slate-800/50 rounded-lg p-4 mb-6">
          <p className="text-sm text-slate-300">
            是否清空当前编辑区域？
          </p>
          <p className="text-xs text-slate-500 mt-1">
            清空后可以继续添加新任务
          </p>
        </div>
        
        <div className="flex gap-3">
          <button
            onClick={onKeepContent}
            className="flex-1 px-4 py-2 bg-slate-700 text-slate-300 rounded-lg"
          >
            保留当前内容
          </button>
          <button
            onClick={onClearContent}
            className="flex-1 px-4 py-2 bg-violet-600 text-white rounded-lg"
          >
            清空并继续
          </button>
        </div>
      </div>
    </Modal>
  );
};

// 清空编辑区域
const clearEditor = () => {
  // 清空素材
  setBVideos([]);
  setAVideos([]);
  setCovers([]);
  setBgImages([]);
  
  // 重置参数
  setOrientation('horizontal');
  setMaterialPositions(getInitialPositions());
  setTaskCount(1);
  
  // 清空任务列表
  setTasks([]);
  setCurrentIndex(0);
  
  // 保留输出目录（或根据用户习惯决定）
  // setOutputDir(defaultOutputDir);
  
  setShowAddSuccessModal(false);
  addLog('已清空编辑区域', 'info');
};
```

---

## 八、数据同步策略

### 8.1 同步架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                           主进程                                    │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐ │
│  │ TaskQueueManager │───►│  TaskExecutor   │───►│   Database      │ │
│  │   (任务调度)     │    │   (执行任务)     │    │   (持久化)      │ │
│  └────────┬────────┘    └────────┬────────┘    └─────────────────┘ │
│           │                      │                                  │
│           │    IPC Events        │                                  │
│           └──────────────────────┘                                  │
│                      │                                              │
│                      ▼                                              │
│           ┌─────────────────────┐                                   │
│           │  事件广播 (IPC)      │                                   │
│           │  task:progress      │                                   │
│           │  task:log           │                                   │
│           │  task:completed     │                                   │
│           │  task:failed        │                                   │
│           └──────────┬──────────┘                                   │
└──────────────────────┼──────────────────────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          渲染进程                                   │
│                                                                     │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  TaskCenterWidget (全局浮窗)                                    │ │
│  │  - 实时监听 IPC 事件                                            │ │
│  │  - 只显示 running 状态的任务                                    │ │
│  │  - 进度/状态实时更新                                            │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                     │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  TaskListPage (任务列表页)                                      │ │
│  │  - 页面加载时从数据库读取                                       │ │
│  │  - 分页加载，支持筛选                                           │ │
│  │  - 不需要实时更新，用户刷新或重新进入时加载                     │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                     │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  TaskDetailPage (任务详情页)                                    │ │
│  │  - 页面加载时从数据库读取任务信息                               │ │
│  │  - 日志通过 IPC 事件实时接收（如果任务正在运行）                 │ │
│  │  - 任务完成后从数据库刷新输出文件                               │ │
│  └────────────────────────────────────────────────────────────────┘ │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 8.2 数据流说明

| 组件 | 数据来源 | 更新方式 |
|------|----------|----------|
| HomeTaskIndicator | IPC 事件 | 实时推送 |
| HeaderTaskIndicator | IPC 事件 | 实时推送 |
| TaskCenterWidget | IPC 事件 | 实时推送 |
| TaskListPage | 数据库 | 按需加载 + 手动刷新 |
| TaskDetailPage | 数据库 + IPC 事件 | 静态数据数据库，日志实时 IPC |

---

## 九、样式规范

### 9.1 状态颜色

| 状态 | 背景 | 文字 | 边框 |
|------|------|------|------|
| pending | `bg-violet-500/10` | `text-violet-400` | `border-violet-500/30` |
| queued | `bg-slate-500/10` | `text-slate-400` | `border-slate-500/30` |
| running | `bg-blue-500/10` | `text-blue-400` | `border-blue-500/30` |
| completed | `bg-emerald-500/10` | `text-emerald-400` | `border-emerald-500/30` |
| failed | `bg-red-500/10` | `text-red-400` | `border-red-500/30` |
| paused | `bg-amber-500/10` | `text-amber-400` | `border-amber-500/30` |
| cancelled | `bg-slate-500/10` | `text-slate-400` | `border-slate-500/30` |

### 9.2 进度条颜色

```tsx
const getProgressColor = (status: TaskStatus) => {
  switch (status) {
    case 'running': return 'bg-gradient-to-r from-blue-500 to-cyan-500';
    case 'completed': return 'bg-gradient-to-r from-emerald-500 to-green-500';
    case 'failed': return 'bg-gradient-to-r from-red-500 to-rose-500';
    case 'paused': return 'bg-gradient-to-r from-amber-500 to-yellow-500';
    default: return 'bg-slate-500';
  }
};
```

### 9.3 图标规范

| 元素 | 图标 | 颜色 |
|------|------|------|
| 任务中心 | `Layers` | violet |
| 运行中指示 | `Loader2` (旋转) | blue |
| 成功 | `CheckCircle` | emerald |
| 失败 | `XCircle` | red |
| 暂停 | `Pause` | amber |
| 开始 | `Play` | 当前主题色 |
| 取消 | `Square` | slate |
| 重试 | `RotateCcw` | 当前主题色 |
| 删除 | `Trash2` | red |
| 详情 | `ChevronRight` | slate |
